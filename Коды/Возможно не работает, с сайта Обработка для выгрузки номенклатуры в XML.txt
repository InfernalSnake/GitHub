Процедура Выгрузка(Кнопка)
       ЗаписьXML=Новый ЗаписьXML;
    ЗаписьXML.ОткрытьФайл("c:\document.xml");
    ЗаписьXML.ЗаписатьНачалоЭлемента("Главный");
    
    Выборка = Справочники.Номенклатура.Выбрать(,,Новый Структура("Код","00000000143"));
    Пока Выборка.Следующий () Цикл
        ОбработкаПрерыванияПользователя();
        
        ЗаписьXML.ЗаписатьНачалоЭлемента("ГруппаОбъектов");
        
        ЗаписьXML.ЗаписатьНачалоЭлемента("Справочник");
        ЗаписатьXML(ЗаписьXML, Выборка.ПолучитьОбъект());
        ЗаписьXML.ЗаписатьКонецЭлемента();

        Если ЗначениеЗаполнено(Выборка.ЕдиницаХраненияОстатков) тогда
            ЗаписьXML.ЗаписатьНачалоЭлемента("ЕдиницаХраненияОстатков");
            ЗаписатьXML(ЗаписьXML, Выборка.ЕдиницаХраненияОстатков.ПолучитьОбъект());
            ЗаписьXML.ЗаписатьКонецЭлемента();
        КонецЕсли;
        
        Если ЗначениеЗаполнено(Выборка.ЕдиницаДляОтчетов) тогда
            ЗаписьXML.ЗаписатьНачалоЭлемента("ЕдиницаДляОтчетов");
            ЗаписатьXML(ЗаписьXML, Выборка.ЕдиницаДляОтчетов.ПолучитьОбъект());
            ЗаписьXML.ЗаписатьКонецЭлемента();
        КонецЕсли;
        
        ЗаписьXML.ЗаписатьКонецЭлемента();
    КонецЦикла;    
    
    ЗаписьXML.ЗаписатьКонецЭлемента();
    ЗаписьXML.Закрыть();
    Сообщить("Выгружено");    
КонецПроцедуры

Процедура Загрузка(Кнопка)
    ДанныеXML = Новый ЧтениеXML;
    ДанныеXML.ОткрытьФайл("c:\document.xml");
    Пока ДанныеXML.Прочитать() Цикл
        ОбработкаПрерыванияПользователя();
        Пока ДанныеXML.Прочитать() Цикл
            Пока ДанныеXML.Прочитать() Цикл
                    ОбработкаПрерыванияПользователя();
                    Если ВозможностьЧтенияXML(ДанныеXML) Тогда
                        НовыйОбъект = ПрочитатьXML(ДанныеXML); // пошел элемент Номенклатуры
                        НовыйОбъект.ОбменДанными.Загрузка=Истина;
                        НовыйОбъект.Записать();

                        Если ВозможностьЧтенияXML(ДанныеXML) Тогда
                            ОбъектЕдиницыХраненияОстатков = ПрочитатьXML(ДанныеXML);
                            ОбъектЕдиницыХраненияОстатков.Владелец=НовыйОбъект.Ссылка;
                            ОбъектЕдиницыХраненияОстатков.Записать();
                        КонецЕсли;
                        
                        Если ВозможностьЧтенияXML(ДанныеXML) Тогда
                            ОбъектЕдиницыДляОтчетов = ПрочитатьXML(ДанныеXML);
                            ОбъектЕдиницыДляОтчетов.Владелец=НовыйОбъект.Ссылка;
                            ОбъектЕдиницыДляОтчетов.Записать(); 
                        КонецЕсли;
                    КонецЕсли;
            КонецЦикла;
        КонецЦикла;
    КонецЦикла;
    ДанныеXML.Закрыть();
    Сообщить("Загружено");
КонецПроцедуры
